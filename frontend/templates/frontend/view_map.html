<!DOCTYPE html>
<html>
    <head>
        <meta charset='utf-8' />
        <title>Library Map</title>

        <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

       
        <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.50.0/mapbox-gl.js'></script>
            <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.50.0/mapbox-gl.css' rel='stylesheet' />
            <link href='../../static/frontend/css/rangeslider.css' rel='stylesheet' />
            <style>
            body { margin:0; padding:0; }
            #map { position:absolute; top:0; bottom:0; width:100%; }
            </style>
            
            <a href="https://icons8.com">Icon pack by Icons8</a>
            </head>
            <body>
                    <style>
                            body {
                                margin: 0;
                                padding: 0;
                            }
                            
                            .map {
                                border-left: 1px solid #243447;
                                position: absolute;
                                left: 33.3333%;
                                width: 66.6666%;
                                top: 0;
                                bottom: 0;
                                z-index: -1;
                            }
                            .sidenav {
                                height: 100%;
                                width: 400px;
                                position: fixed;
                                z-index: 12;
                                top: 0;
                                left: 0;
                                background-color: #243447;
                                overflow-x: hidden;
                                padding-top: 20px;
                            }
                            .sidenav a {
                                padding: 6px 8px 6px 16px;
                                text-decoration: none;
                                font-size: 25px;
                                color: #818181;
                                display: block;
                            }
                            .sidenav a:hover {
                                color: #000000;
                            }
                            .accordion {
                                background-color: #243447;
                                color: #fff;
                                cursor: pointer;
                                padding: 18px;
                                width: 100%;
                                border: none;
                                text-align: left;
                                outline: none;
                                font-size: 25px;
                                transition: 0.4s;
                            }
                            .active,
                            .accordion:hover {
                                background-color: #c51f5d;
                            }
                            h2 {
                                margin-bottom:0;
                            }       
                            h3 {
                                margin:0 0 30px;
                            } 
                            .ui-slider-range {
                                background:green;
                            }
                            .percent {
                                color:green;
                                font-weight:bold;
                                text-align:center;
                                width:100%;
                                border:none;
                            }
                            .panel {
                                padding: 0 18px;
                                display: none;
                                background-color: white;
                                overflow: hidden;
                            }
                            #info{
                                margin-top: 3cm;
                                width: 100%;
                                vertical-align: center;
                                color: #c51f5d;
                            }
                        </style>
                        <div class="sidenav">
                            <div class="spacing"></div>
                            <button class="accordion" id="homepage"> Homepage</button>
                            <form action="{% url 'update' %}" method="POST">
                                {% csrf_token %}
                                <div id = "info">
                                    <input name="location" id="location" style="visibility: hidden;"/>
                                    <input name="myRange" id="myRange" style="visibility:hidden;"/>
                                    <p id="out" style="visibility:hidden;"></p>
                                </div>
                            </form>
                            
                            
                            <!-- Issac: This section does not work. Only the word "Percentage Full" shows-->
                            <script>
                                
                            </script>
                
                    
                            
                    </div>
            
            
            
            <style>
            .marker {
                background-image: url("https://img.icons8.com/color/50/000000/library.png");
                background-size: cover;
                width: 50px;
                height: 50px;
                border-radius: 50%;
                cursor: pointer;
                z-index: 10;
            }


            
            
            .mapboxgl-popup {
                max-width: 200px;
            }
            
            .mapboxgl-popup-content {
                text-align: center;
                font-family: 'Open Sans', sans-serif;
            }
            </style>
            
            <script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v3.1.3/mapbox-gl-directions.js'></script>
            <link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v3.1.3/mapbox-gl-directions.css' type='text/css' />
            <div id='map'></div>
                      
            <script>
            mapboxgl.accessToken = 'pk.eyJ1IjoiYWJzdXJkdmFjYXRpb24iLCJhIjoiY2puamxqNXV2MG4yeDNwbGs1MmozcDZvdCJ9.AWfhzxC6hwtwrq8yFbfBOA';
            var js_list = "{{ all_libraries | escapejs }}"
            var geojson = JSON.parse(js_list)
            
            
            var map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/streets-v9',
            center: [-78.5064, 38.0348],
            zoom: 16
            });
            
        
                
    
            // add markers to map
            geojson.forEach(function(marker) {
            var temp = marker.fields.coordinates.split(" ")
            for (var i = 0; i < temp.length; i++){
                temp[i] = Number(temp[i])
            }
            // create a DOM element for the marker
            var el = document.createElement('div');
            el.className = 'marker';
          
            // add marker to map
            new mapboxgl.Marker(el)
            .setLngLat(temp)
            .setPopup(new mapboxgl.Popup({offset: 25})
            .setHTML('<h3>' + marker.fields.title + '</h3>   <button type = "button" onclick="showDetail(\'' + marker.fields.location_name + '\')" > See Details </button>'))

            .addTo(map);
            });


            
            // Add geolocate control to the map.
            map.addControl(new mapboxgl.GeolocateControl({
            positionOptions: {
            enableHighAccuracy: true
            },
            trackUserLocation: true
            }));
            
            map.addControl(new MapboxDirections({
                accessToken: mapboxgl.accessToken
            }), 'top-right');
            
            
            </script>
           
            </body>
            <script src="../../static/frontend/js/map.js"></script>
            
            </html>
